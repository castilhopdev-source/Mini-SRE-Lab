
version: '3'

services: #ğŸ§± DefiniÃ§Ã£o de ServiÃ§os: Aqui comeÃ§a a definiÃ§Ã£o dos containers que fazem parte da aplicaÃ§Ã£o, cada item dentro de services vira um container.
  nginx: #Define o nome do serviÃ§o: Esse nome vira o hostname interno na rede Docker, por isso o monitor usa: #URL = "http://nginx"
    build: ./nginx #ğŸ“Œ O que faz: Instrui o Compose a: Construir a imagem usando o Dockerfile dentro da pasta ./nginx | Equivalente a: docker build -t nginx ./nginx
    container_name: sre_nginx # ğŸ“Œ O que faz: Define nome fixo do container, isso facilita: Debug, Logs e SimulaÃ§Ã£o de falhas
    ports:  ###### ğŸ“Œ O que faz: Mapeia portas | Porta 8080 da sua mÃ¡quina | Para porta 80 do container | Assim vocÃª pode acessar: http://localhost:8080
      - "8080:80"
    restart: always
    healthcheck:
      test: ["CMD", "wget", "--spider", "-q", "http://localhost"]
      interval: 10s
      timeout: 5s
      retries: 3
  monitor:
    build: ./monitor
    container_name: sre_monitor 
    depends_on: # ğŸ“Œ O que faz: Garante que o nginx seja iniciado antes do monitor, âš ï¸ Importante Isso nÃ£o garante que o nginx esteja pronto, apenas que foi iniciado. 
      - nginx
  prometheus:
    image: prom/prometheus
    container_name: sre_prometheus
    ports:
      - "9090:9090"
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml
    depends_on:
      - monitor
  chaos:
    build: ./chaos
    container_name: sre_chaos 
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock #Permite que o container controle o Docker host, isso Ã© poderoso â€” e perigoso em produÃ§Ã£o, mas em lab Ã© perfeito.
    depends_on:
      - nginx
  grafana:
    image: grafana/grafana
    container_name: sre_grafana
    ports:
      - "3000:3000"
    volumes:
      - grafana_data:/var/lib/grafana
    depends_on:
      - prometheus
volumes:
  grafana_data:

#ğŸ“„ Arquivo: docker-compose.yml
#ğŸ¯ Objetivo
#Definir e orquestrar:
#O serviÃ§o alvo (nginx)
#O serviÃ§o de monitoramento (monitor)
#A rede interna entre eles
#DependÃªncia de inicializaÃ§Ã£o
#Ele representa, em escala menor, o que seria feito em:
#Kubernetes
#ECS
#Docker Swarm

     